<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <title>تحكم في البوت</title>
  <style>
    body{font-family:Arial;background:#111;color:#fff;text-align:center;padding:50px}
    .box{background:#222;padding:40px;border-radius:12px;max-width:400px;margin:auto}
    button{background:#e1306c;color:#fff;padding:14px 28px;border:none;border-radius:6px;font-size:18px;margin:10px;cursor:pointer}
    button.stop{background:#888}
    #result{margin-top:20px;font-size:16px}
  </style>
</head>
<body>
  <div class="box">
    <h1>تحكم في البوت</h1>
    <button type="button" id="startBtn">▶️ تشغيل البوت</button>
    <button type="button" id="stopBtn" class="stop">⏸️ إيقاف البوت</button>
    <div id="result"></div>
  </div>

  <script>
    // تشغيل البوت
    document.getElementById('startBtn').addEventListener('click', async () => {
      try {
        console.log('[Bot] Sending start request...');
        const response = await fetch('/api/trpc/bot.start', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username: '3e223',
            password: null,
            sessionData: null
          })
        });

        console.log('[Bot] Response status:', response.status);
        const text = await response.text();
        console.log('[Bot] Raw response:', text);

        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          console.error('[Bot] Failed to parse JSON:', e);
          document.getElementById('result').innerHTML = `<span style="color:#f00">❌ خطأ: ${text}</span>`;
          return;
        }

        console.log('[Bot] Parsed result:', result);
        document.getElementById('result').innerHTML = 
          result.success ? 
          '<span style="color:#0f0">✅ تم تشغيل البوت!</span>' : 
          `<span style="color:#f00">❌ خطأ: ${result.message || 'رسالة غير معروفة'}</span>`;
      } catch (e) {
        console.error('[Bot] Connection error:', e);
        document.getElementById('result').innerHTML = '<span style="color:#f00">❌ خطأ في الاتصال</span>';
      }
    });

    // إيقاف البوت
    document.getElementById('stopBtn').addEventListener('click', async () => {
      try {
        console.log('[Bot] Sending stop request...');
        const response = await fetch('/api/trpc/bot.stop', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({})
        });

        console.log('[Bot] Response status:', response.status);
        const text = await response.text();
        console.log('[Bot] Raw response:', text);

        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          console.error('[Bot] Failed to parse JSON:', e);
            document.getElementById('result').innerHTML = `<span style="color:#f00">❌ خطأ: ${text}</span>`;
          return;
        }

        console.log('[Bot] Parsed result:', result);
        document.getElementById('result').innerHTML = 
          result.success ? 
          '<span style="color:#0f0">✅ تم إيقاف البوت!</span>' : 
          `<span style="color:#f00">❌ خطأ: ${result.message || 'رسالة غير معروفة'}</span>`;
      } catch (e) {
        console.error('[Bot] Connection error:', e);
        document.getElementById('result').innerHTML = '<span style="color:#f00">❌ خطأ في الاتصال</span>';
      }
    });
  </script>
</body>
</html>
